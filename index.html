<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Filter Data Absensi</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
    
    /* Modern CSS Variables */
    :root {
      --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --primary-solid: #667eea;
      --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --success: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      
      --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card: rgba(255, 255, 255, 0.95);
      --card-hover: rgba(255, 255, 255, 0.98);
      --glass: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      
      --text-primary: #2d3748;
      --text-secondary: #718096;
      --text-muted: #a0aec0;
      --text-white: #ffffff;
      
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
      --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Plus Jakarta Sans', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      color: var(--text-primary);
      line-height: 1.6;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 200, 255, 0.2) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      position: relative;
    }

    /* Header Styles */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      padding: 1.5rem 2rem;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-lg);
      animation: slideInDown 0.6s ease-out;
    }

    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-white);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      margin: 0;
    }

    .format-hint {
      background: rgba(255, 255, 255, 0.2);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      color: var(--text-white);
      font-size: 0.875rem;
      font-weight: 500;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    /* Card Styles */
    .card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: 2rem;
      box-shadow: var(--shadow-xl);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      animation: slideInUp 0.8s ease-out;
    }

    .card:hover {
      background: var(--card-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl), 0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    /* Filter Section */
    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      align-items: end;
      margin-bottom: 1rem;
    }

    .field {
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .field label {
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      transition: color 0.2s ease;
    }

    /* Input Styles */
    input[type="text"], 
    select {
      padding: 1rem 1.25rem;
      border-radius: var(--radius-md);
      border: 2px solid rgba(226, 232, 240, 0.8);
      background: rgba(255, 255, 255, 0.9);
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      position: relative;
    }

    input[type="text"]:focus, 
    select:focus {
      outline: none;
      border-color: var(--primary-solid);
      background: rgba(255, 255, 255, 1);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-1px);
    }

    input[type="text"]::placeholder {
      color: var(--text-muted);
      font-weight: 400;
    }

    /* Button Styles */
    .btn {
      background: var(--primary);
      color: var(--text-white);
      padding: 1rem 1.5rem;
      border-radius: var(--radius-md);
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-md);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn.secondary {
      background: rgba(255, 255, 255, 0.9);
      color: var(--primary-solid);
      border: 2px solid rgba(102, 126, 234, 0.2);
      backdrop-filter: blur(10px);
    }

    .btn.secondary:hover {
      background: rgba(255, 255, 255, 1);
      border-color: var(--primary-solid);
    }

    .button-group {
      display: flex;
      gap: 0.75rem;
    }

    .page-size-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: rgba(255, 255, 255, 0.7);
      border-radius: var(--radius-md);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .page-size-control select {
      padding: 0.5rem;
      border: 1px solid rgba(226, 232, 240, 0.5);
      min-width: auto;
    }

    /* Table Styles */
    .table-wrap {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius-lg);
      overflow-x: auto;
      overflow-y: visible;
      margin-top: 1.5rem;
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
    }

    /* Custom scrollbar for table */
    .table-wrap::-webkit-scrollbar {
      height: 8px;
    }

    .table-wrap::-webkit-scrollbar-track {
      background: rgba(226, 232, 240, 0.3);
      border-radius: 4px;
    }

    .table-wrap::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }

    .table-wrap::-webkit-scrollbar-thumb:hover {
      background: var(--secondary);
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 800px;
    }

    th, td {
      padding: 1rem 1.25rem;
      text-align: left;
      border-bottom: 1px solid rgba(226, 232, 240, 0.6);
      font-size: 0.875rem;
      transition: background-color 0.2s ease;
    }

    th {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      position: sticky;
      top: 0;
      font-weight: 700;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.75rem;
      z-index: 10;
    }

    tbody tr {
      transition: all 0.2s ease;
    }

    tbody tr:hover {
      background: rgba(102, 126, 234, 0.05);
      transform: scale(1.005);
    }

    .empty {
      padding: 3rem;
      text-align: center;
      color: var(--text-muted);
      font-style: italic;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    }

    /* Pagination Styles */
    .table-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 1.5rem;
      padding: 1rem 0;
    }

    .summary {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .pagination {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .pager-btn {
      padding: 0.75rem 1rem;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(226, 232, 240, 0.8);
      background: rgba(255, 255, 255, 0.9);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
    }

    .pager-btn:hover:not(:disabled) {
      background: var(--primary);
      color: var(--text-white);
      border-color: transparent;
      transform: translateY(-1px);
    }

    .pager-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pager-input {
      width: 4rem;
      padding: 0.75rem;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(226, 232, 240, 0.8);
      text-align: center;
      font-weight: 600;
    }

    .page-info {
      color: var(--text-secondary);
      font-size: 0.875rem;
      padding: 0 0.75rem;
    }

    /* Footer */
    footer {
      margin-top: 2rem;
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.875rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: slideInUp 1s ease-out 0.2s both;
    }

    /* Animations */
    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-2rem);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(2rem);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Loading State */
    .loading {
      position: relative;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 2rem;
      height: 2rem;
      margin: -1rem 0 0 -1rem;
      border: 3px solid rgba(102, 126, 234, 0.2);
      border-top-color: var(--primary-solid);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }

      .filters {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .button-group {
        flex-direction: column;
      }

      .table-footer {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
      }

      .pagination {
        justify-content: center;
        flex-wrap: wrap;
      }

      h1 {
        font-size: 1.5rem;
      }

      .card {
        padding: 1.5rem;
      }

      /* Enhanced table scrolling for mobile */
      .table-wrap {
        position: relative;
        border-radius: var(--radius-md);
      }

      .table-wrap::after {
        content: '← Geser untuk melihat lebih banyak →';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
        text-align: center;
        padding: 0.5rem;
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-weight: 500;
        pointer-events: none;
        opacity: 0.8;
      }

      table {
        min-width: 600px; /* Lebih kecil untuk mobile tapi tetap cukup untuk nama & kelas */
      }

      th, td {
        padding: 0.75rem 1rem;
        font-size: 0.8rem;
        white-space: nowrap;
      }

      /* Sticky kolom nama (biasanya kolom ke-3 atau yang mengandung nama) */
      th[data-column="nama"], 
      td[data-column="nama"],
      th:nth-child(3), 
      td:nth-child(3) {
        position: sticky;
        left: 0;
        background: rgba(255, 255, 255, 0.98);
        z-index: 5;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        backdrop-filter: blur(20px);
      }

      th:nth-child(3) {
        z-index: 15;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
      }

      /* Jika struktur data berbeda, buat kolom nama tetap terlihat */
      .sticky-name-column {
        position: sticky !important;
        left: 0 !important;
        background: rgba(255, 255, 255, 0.98) !important;
        z-index: 5 !important;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1) !important;
        backdrop-filter: blur(20px) !important;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 0.75rem;
      }

      .card {
        padding: 1rem;
        border-radius: var(--radius-md);
      }

      header {
        padding: 1rem;
      }

      .pagination {
        gap: 0.25rem;
      }

      .pager-btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
      }

      /* Mobile table optimizations */
      table {
        min-width: 500px; /* Bahkan lebih kecil untuk layar sangat kecil */
      }

      th, td {
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
      }

      /* Sticky kolom nama untuk mobile kecil */
      th:nth-child(3), 
      td:nth-child(3) {
        min-width: 120px; /* Lebar minimum untuk nama */
        max-width: 150px;
      }

      /* Alternatif: sticky kolom yang berisi nama siswa */
      .name-column {
        position: sticky !important;
        left: 0 !important;
        background: rgba(255, 255, 255, 0.98) !important;
        z-index: 5 !important;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1) !important;
        backdrop-filter: blur(20px) !important;
        min-width: 120px;
        max-width: 150px;
      }

      .table-wrap::after {
        content: '← Geser →';
        font-size: 0.7rem;
        padding: 0.25rem;
      }
    }

    /* Accessibility Improvements */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Focus indicators for better accessibility */
    .btn:focus,
    input:focus,
    select:focus {
      outline: 2px solid var(--primary-solid);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Filter Data Absensi Siswa SDN 2 Karangmangu</h1>
      <div class="format-hint">Format tanggal: <strong>dd/mm/yyyy</strong> (Tanggal/Bulan/Tahun)</div>
    </header>

    <div class="card">
      <div class="filters">
        <div class="field">
          <label for="kelas">Pilih Kelas</label>
          <select id="kelas">
            <option value="">Semua Kelas</option>
            <option value="Kelas 1">Kelas 1</option>
            <option value="Kelas 2">Kelas 2</option>
            <option value="Kelas 3A">Kelas 3A</option>
            <option value="Kelas 3B">Kelas 3B</option>
            <option value="Kelas 4A">Kelas 4A</option>
            <option value="Kelas 4B">Kelas 4B</option>
            <option value="Kelas 5">Kelas 5</option>
            <option value="Kelas 6">Kelas 6</option>
          </select>
        </div>

        <div class="field">
          <label for="start">Tanggal Mulai</label>
          <input id="start" type="text" placeholder="dd/mm/yyyy" />
        </div>

        <div class="field">
          <label for="end">Tanggal Akhir</label>
          <input id="end" type="text" placeholder="dd/mm/yyyy" />
        </div>

        <div class="field">
          <label>&nbsp;</label>
          <div class="button-group">
            <button id="btnFilter" class="btn">Terapkan Filter</button>
            <button id="btnReset" class="btn secondary">Reset</button>
          </div>
        </div>

        <div class="field">
          <label>&nbsp;</label>
          <div class="page-size-control">
            <span>Tampilkan:</span>
            <select id="pageSize">
              <option>10</option>
              <option selected>20</option>
              <option>50</option>
              <option>100</option>
            </select>
            <span>baris</span>
          </div>
        </div>
      </div>

      <div class="table-wrap">
        <table id="dataTable" aria-live="polite">
          <thead>
            <tr id="tableHead">
              <!-- akan diisi -->
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr><td colspan="6" class="empty">Gunakan filter di atas lalu klik <strong>Terapkan Filter</strong></td></tr>
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <div class="summary" id="summary">Menampilkan —</div>
        <div class="pagination" id="pagination"></div>
      </div>
    </div>

    <footer>
      Masukkan tanggal dimulai dari Tanggal/Bulan/Tahun sesuai database
    </footer>
  </div>

  <script>
    // ====== CONFIG: ganti WEB_APP_URL dengan URL hasil deploy Apps Script (.exec) ======
    const appConfig = {
      WEB_APP_URL: "https://script.google.com/macros/s/AKfycbz-J106eol_hMxv025VRCj4XKAORfFhDzZ03B0A4cEFYEh0L5fcVKKs6ONAh6pTSwyz/exec" // contoh: https://script.google.com/macros/s/AKfy.../exec
    };

    // util: validate dd/mm/yyyy or dd/mm/yyyy hh:mm:ss
    function parseDDMMYYYY(s) {
      if (!s) return null;
      s = s.trim();
      const m = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})(?:\s+(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?)?$/);
      if (!m) return null;
      const day = parseInt(m[1],10);
      const month = parseInt(m[2],10) - 1;
      const year = parseInt(m[3],10);
      const hour = m[4] ? parseInt(m[4],10) : 0;
      const min = m[5] ? parseInt(m[5],10) : 0;
      const sec = m[6] ? parseInt(m[6],10) : 0;
      const d = new Date(year, month, day, hour, min, sec);
      if (isNaN(d.getTime())) return null;
      return d;
    }

    function formatDisplayDateFromIso(iso) {
      if (!iso) return "";
      const d = new Date(iso);
      const pad = n => n < 10 ? "0"+n : n;
      return pad(d.getDate()) + "/" + pad(d.getMonth()+1) + "/" + d.getFullYear() + " " + pad(d.getHours()) + ":" + pad(d.getMinutes()) + ":" + pad(d.getSeconds());
    }

    // state
    let state = {
      page: 1,
      pageSize: 20,
      totalPages: 1,
      total: 0,
      headers: []
    };

    // DOM
    const el = {
      kelas: document.getElementById("kelas"),
      start: document.getElementById("start"),
      end: document.getElementById("end"),
      btnFilter: document.getElementById("btnFilter"),
      btnReset: document.getElementById("btnReset"),
      tableHead: document.getElementById("tableHead"),
      tableBody: document.getElementById("tableBody"),
      pagination: document.getElementById("pagination"),
      pageSize: document.getElementById("pageSize"),
      summary: document.getElementById("summary"),
    };

    el.btnFilter.addEventListener("click", () => {
      state.page = 1;
      fetchAndRender();
    });
    el.btnReset.addEventListener("click", () => {
      el.kelas.value = "";
      el.start.value = "";
      el.end.value = "";
      state.page = 1;
      fetchAndRender();
    });
    el.pageSize.addEventListener("change", () => {
      state.pageSize = parseInt(el.pageSize.value, 10) || 20;
      state.page = 1;
      fetchAndRender();
    });

    async function fetchAndRender() {
      // validate start/end
      const kelas = el.kelas.value.trim();
      const start = el.start.value.trim();
      const end = el.end.value.trim();

      // If provided and invalid format, show message
      if (start && !parseDDMMYYYY(start)) {
        alert("Format Tanggal Mulai harus dd/mm/yyyy atau dd/mm/yyyy hh:mm:ss");
        return;
      }
      if (end && !parseDDMMYYYY(end)) {
        alert("Format Tanggal Akhir harus dd/mm/yyyy atau dd/mm/yyyy hh:mm:ss");
        return;
      }

      // build query
      const params = new URLSearchParams();
      if (kelas) params.append("kelas", kelas);
      if (start) params.append("start", start);
      if (end) params.append("end", end);
      params.append("page", String(state.page));
      params.append("pageSize", String(state.pageSize));

      const url = appConfig.WEB_APP_URL + "?" + params.toString();

      // show loading
      el.tableBody.innerHTML = '<tr><td colspan="20" class="empty loading">Memuat data…</td></tr>';
      try {
        const res = await fetch(url);
        if (!res.ok) {
          const txt = await res.text();
          throw new Error("HTTP " + res.status + " - " + txt);
        }
        const json = await res.json();
        if (json.error) {
          throw new Error(json.error);
        }
        state.total = json.total || 0;
        state.page = json.page || 1;
        state.pageSize = json.pageSize || state.pageSize;
        state.totalPages = json.totalPages || Math.max(1, Math.ceil(state.total / state.pageSize));
        renderTable(json.items || []);
        renderPagination();
        el.summary.textContent = `Menampilkan ${ (json.items||[]).length } dari ${state.total} baris — Halaman ${state.page} / ${state.totalPages}`;
      } catch (err) {
        el.tableBody.innerHTML = '<tr><td colspan="20" class="empty">Gagal memuat data: ' + String(err) + '</td></tr>';
        el.summary.textContent = "Error saat memuat data";
        console.error(err);
      }
    }

    function renderTable(items) {
      if (!items || items.length === 0) {
        el.tableBody.innerHTML = '<tr><td colspan="20" class="empty">Tidak ada data sesuai filter.</td></tr>';
        // still attempt to show headers if known
        if (state.headers && state.headers.length) {
          buildHeaderRow(state.headers);
        }
        return;
      }
      // derive headers from first item (object)
      const first = items[0];
      const headers = Object.keys(first).filter(k => !k.startsWith("_"));
      state.headers = headers;
      buildHeaderRow(headers);

      const rows = items.map(item => {
        const tds = headers.map((h, index) => {
          let v = item[h];
          // if header contains 'timestamp' or 'time' show formatted display
          if (/timestamp|time|tgl|tanggal/i.test(h)) {
            if (item._timestamp_display) v = item._timestamp_display;
            else if (item[h]) v = String(item[h]);
          }
          
          // Add class for name column (assuming it contains 'nama' or is the last text column)
          const isNameColumn = /nama|name|siswa/i.test(h) || (typeof v === 'string' && v.length > 5 && !/\d{2}\/\d{2}\/\d{4}/.test(v));
          const className = isNameColumn ? 'name-column' : '';
          
          return `<td class="${className}">${escapeHtml(v === null || v === undefined ? "" : String(v))}</td>`;
        }).join("");
        return `<tr>${tds}</tr>`;
      });
      el.tableBody.innerHTML = rows.join("");
    }

    function buildHeaderRow(headers) {
      const headerHtml = headers.map((h, index) => {
        // Add class for name column header
        const isNameColumn = /nama|name|siswa/i.test(h);
        const className = isNameColumn ? 'name-column' : '';
        return `<th class="${className}">${escapeHtml(h)}</th>`;
      }).join("");
      el.tableHead.innerHTML = headerHtml;
    }

    function renderPagination() {
      const frag = [];
      const p = state.page;
      const tp = state.totalPages;

      frag.push(`<button class="pager-btn" ${p===1?'disabled':''} onclick="window.appGotoPage(1)">« First</button>`);
      frag.push(`<button class="pager-btn" ${p===1?'disabled':''} onclick="window.appGotoPage(${p-1})">‹ Prev</button>`);
      frag.push(`<span class="page-info">Halaman</span>`);
      frag.push(`<input class="pager-input" type="number" min="1" max="${tp}" value="${p}" onchange="window.appGotoPage(this.value)" />`);
      frag.push(`<span class="page-info">dari ${tp}</span>`);
      frag.push(`<button class="pager-btn" ${p===tp?'disabled':''} onclick="window.appGotoPage(${p+1})">Next ›</button>`);
      frag.push(`<button class="pager-btn" ${p===tp?'disabled':''} onclick="window.appGotoPage(${tp})">Last »</button>`);

      el.pagination.innerHTML = frag.join("");
    }

    // global function for onclick in pagination (unsafe but simple)
    window.appGotoPage = function(n) {
      const nn = parseInt(n,10);
      if (isNaN(nn)) return;
      state.page = Math.max(1, Math.min(state.totalPages, nn));
      fetchAndRender();
    };

    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    // initial load (no filter -> show nothing)
    (function init(){
      // set page size initial
      state.pageSize = parseInt(el.pageSize.value, 10) || 20;
      // if you want to auto-fetch on load, uncomment next line:
      // fetchAndRender();
    })();
  </script>
</body>
</html>
